<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—éƒ¨åœ°å€æ¨™æ¡ˆæµæ¨™ç›£æ§ç³»çµ±</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --pcc-blue: #004a91; }
        .header-bg { background: var(--pcc-blue); color: white; padding: 2rem 0; margin-bottom: 2rem; }
        .filter-card { border-left: 5px solid var(--pcc-blue); }
        .budget-text { font-family: 'Courier New', Courier, monospace; font-weight: bold; color: #d9534f; }
    </style>
</head>
<body class="bg-light">

<div class="header-bg shadow">
    <div class="container">
        <h1>åŒ—éƒ¨åœ°å€æµæ¨™ç›£æ§çœ‹æ¿</h1>
        <p class="mb-0">å³æ™‚åˆ†æå°åŒ—ã€æ–°åŒ—ã€åŸºéš†ã€æ¡ƒåœ’ã€å®œè˜­ã€æ–°ç«¹ä¹‹æµæ¨™æ¡ˆä»¶</p>
    </div>
</div>

<div class="container">
    <div class="card shadow-sm mb-4 filter-card">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-bold">æœ€ä½é ç®—ç¯©é¸ (NTD)</label>
                    <input type="number" id="minAmount" class="form-control" placeholder="è¼¸å…¥é‡‘é¡ï¼Œä¾‹å¦‚ 1000000" oninput="applyFilters()">
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold">åœ°å€å¿«é€Ÿç¯©é¸</label>
                    <select id="cityFilter" class="form-select" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨åŒ—éƒ¨ç¸£å¸‚</option>
                        <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                        <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                        <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                        <option value="æ–°ç«¹">æ–°ç«¹ç¸£å¸‚</option>
                        <option value="åŸºéš†">åŸºéš†/å®œè˜­</option>
                    </select>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-outline-secondary" onclick="fetchData()">ğŸ”„ é‡æ–°æ•´ç†è³‡æ–™</button>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive shadow-sm rounded">
        <table class="table table-hover bg-white align-middle">
            <thead class="table-dark">
                <tr>
                    <th style="width: 120px;">æ¡ˆè™Ÿ</th>
                    <th>æ¨™æ¡ˆåç¨± / æ‹›æ¨™æ©Ÿé—œ</th>
                    <th style="width: 100px;">åœ°å€</th>
                    <th style="width: 150px;">é ç®—é‡‘é¡</th>
                    <th>æµæ¨™åŸå› </th>
                </tr>
            </thead>
            <tbody id="data-table">
                <tr><td colspan="5" class="text-center py-5">è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwWNuc5yGNFJ5erxtpIY_MQHpYSUzUgPXpn7KJ-TCmRBy0pwOrdmOBSnFiIjPgEmhTT/exec"; // âš ï¸ è«‹åœ¨æ­¤è™•è²¼ä¸Šæ‚¨çš„ GAS URL
    let tenderData = [];

    // 1. å¾ GAS ç²å–è³‡æ–™
    async function fetchData() {
        try {
            const response = await fetch(API_URL);
            tenderData = await response.json();
            applyFilters();
        } catch (error) {
            document.getElementById('data-table').innerHTML = `<tr><td colspan="5" class="text-center text-danger">é€£ç·šå¤±æ•—ï¼šè«‹æª¢æŸ¥ GAS éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œæ‰€æœ‰äººã€ã€‚</td></tr>`;
        }
    }

    // 2. åŸ·è¡Œéæ¿¾é‚è¼¯ (é‡‘é¡ + åœ°å€)
    function applyFilters() {
        const minAmount = document.getElementById('minAmount').value || 0;
        const cityKeyword = document.getElementById('cityFilter').value;

        const filtered = tenderData.filter(item => {
            const matchAmount = item.budget >= minAmount;
            const matchCity = cityKeyword === "" || item.city.includes(cityKeyword);
            return matchAmount && matchCity;
        });

        renderTable(filtered);
    }

    // 3. æ¸²æŸ“è¡¨æ ¼åˆ°ç¶²é 
    function renderTable(data) {
        const tableBody = document.getElementById('data-table');
        if (data.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-5">æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„æ¨™æ¡ˆã€‚</td></tr>`;
            return;
        }

        tableBody.innerHTML = data.map(item => `
            <tr>
                <td><small class="text-muted">${item.id}</small></td>
                <td>
                    <div class="fw-bold text-primary">${item.title}</div>
                    <div class="small text-secondary">${item.org}</div>
                </td>
                <td><span class="badge bg-info text-dark">${item.city.substring(0, 3)}</span></td>
                <td class="budget-text">NT$ ${Number(item.budget).toLocaleString()}</td>
                <td><span class="text-danger small">${item.reason}</span></td>
            </tr>
        `).join('');
    }

    // é é¢é–‹å•Ÿæ™‚è‡ªå‹•åŸ·è¡Œ
    window.onload = fetchData;
</script>

</body>
</html>
